<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ロボット位置表示</title>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }

        .position-container {
            margin-top: 10px;
            font-size: 18px;
            font-weight: bold;
        }

        .map {
            position: relative;
            width: 90vw;
            max-width: 600px;
            height: 90vw;
            max-height: 600px;
            background: url('background.jpg') no-repeat center center;
            background-size: cover;
            border: 2px solid white;
            margin: 20px auto;
        }

        .robot {
            position: absolute;
            width: 5%;
            height: 5%;
            background-color: blue;
            border-radius: 50%;
            transform-origin: center;
        }

        .buttons {
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }

        .btn-start-left {
            background-color: red;
            color: white;
        }

        .btn-start-right {
            background-color: blue;
            color: white;
        }

        /* スマホ対応 */
        @media (max-width: 600px) {
            .btn {
                font-size: 14px;
                padding: 8px 16px;
            }
        }
    </style>
</head>

<body>

    <h1>ロボットの位置表示</h1>

    <div class="position-container">
        <p>X座標: <span id="position_x">0</span></p>
        <p>Y座標: <span id="position_y">0</span></p>
        <p>向き: <span id="direction">0</span>°</p>
    </div>

    <div class="map" id="map">
        <div class="robot" id="robot"></div>
    </div>

    <div class="buttons">
        <button class="btn btn-start-left" onclick="setStartPosition('left')">左下スタート</button>
        <button class="btn btn-start-right" onclick="setStartPosition('right')">右下スタート</button>
    </div>

    <script>
        const ws = new WebSocket("ws://192.168.30.216:8080/ws");

        let position_x = 0, position_y = 0, direction = 0;
        let startPosition = "right";  // デフォルトは右下
        const robot = document.getElementById("robot");
        const posXElement = document.getElementById("position_x");
        const posYElement = document.getElementById("position_y");
        const directionElement = document.getElementById("direction");
        const map = document.getElementById("map");

        function setStartPosition(position) {
            startPosition = position;
            updateRobotPosition();  // スタート位置を切り替えたら即時反映
        }

        ws.onmessage = function (event) {
            var dataArray = event.data.split(",");
            position_x = Math.max(0, Math.min(1000, parseInt(dataArray[0]))); // 0~1000の範囲で制限
            position_y = Math.max(0, Math.min(1000, parseInt(dataArray[1])));
            direction = 90 - parseInt(dataArray[2]);

            updateRobotPosition();
        };

        function updateRobotPosition() {
            let mapSize = map.clientWidth; // マップのサイズを取得
            let scale = mapSize / 1000; // 座標のスケール変換

            if (startPosition === "right") {
                robot.style.left = Math.max(0, Math.min(mapSize - robot.clientWidth, mapSize - position_x * scale)) + "px";
            } else {
                robot.style.left = Math.max(0, Math.min(mapSize - robot.clientWidth, position_x * scale)) + "px";
            }

            robot.style.top = Math.max(0, Math.min(mapSize - robot.clientHeight, mapSize - position_y * scale)) + "px";
            robot.style.transform = "rotate(" + -direction + "deg)";

            posXElement.innerHTML = position_x;
            posYElement.innerHTML = position_y;
            directionElement.innerHTML = direction;
        }

        window.addEventListener("resize", updateRobotPosition); // 画面サイズ変更時に位置を調整
    </script>

</body>

</html>
